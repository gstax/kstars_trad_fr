<html><head><title>L'outil de construction de scripts</title><link rel="stylesheet" type="text/css" href="help:/kdoctools5-common/kde-default.css"><link rel="stylesheet" type="text/css" href="help:/kdoctools5-common/kde-docs.css"><link rel="stylesheet" type="text/css" href="help:/kdoctools5-common/kde-localised.css"><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"><meta name="keywords" content="KDE, kdeedu, Astronomie, KStars"><link rel="home" href="index.html" title="Manuel de KStars"><link rel="up" href="tools.html" title="Chapter 5. Outils de KStars"><link rel="prev" href="tool-whatsup.html" title="Dans le ciel cette nuit"><link rel="next" href="tool-solarsys.html" title="Afficheur du système solaire"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="GENERATOR" content="KDE XSL Stylesheet V1.14 using libxslt"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div id="content"><div id="header"><div id="header_content"><div id="header_left"><div id="header_right"><img src="help:/kdoctools5-common/top-kde.jpg" width="36" height="34"> L'outil de construction de scripts</div></div></div></div><div class="navCenter"><table class="navigation"><tr><td class="prevCell"><a accesskey="p" href="tool-whatsup.html">Prev</a></td><td class="upCell">Outils de <span class="application">KStars</span></td><td class="nextCell"><a accesskey="n" href="tool-solarsys.html">Next</a></td></tr></table></div><div id="contentBody"><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tool-scriptbuilder"></a>L'outil de construction de scripts</h2></div></div></div><a class="indexterm" name="idm3585"></a><p>Les applications <span class="application">KStars</span> peuvent être pilotées de l'extérieur par un autre programme, depuis une invite de console ou depuis un script shell en utilisant protocole de communication interprocessus (<acronym class="acronym">D-Bus</acronym>). <span class="application">KStars</span> utilise cette fonction pour permettre à des comportements plutôt complexes d'être traités par scripts et rejoués à n'importe quel moment. Ceci peut être utilisé par exemple pour créer une démonstration de salle en classe pour illustrer un concept astronomique. </p><p>Le problème avec les scripts <acronym class="acronym">D-Bus</acronym> est que leur écriture ressemble à de la programmation, et peut sembler difficile à ceux qui n'ont pas l'expérience de la programmation. L'outil de génération de scripts fournit une interface graphique de type pointer-cliquer pour construire des scripts <acronym class="acronym">D-Bus</acronym> pour <span class="application">KStars</span>, rendant très facile l'écriture de scripts complexes. </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sb-intro"></a>Introduction au constructeur de scripts</h3></div></div></div><p>Avant d'expliquer comment utiliser le générateur de scripts, je fournis une très brève introduction de tous les composants d'interface graphique ; pour plus d'informations, utilisez la fonction « Qu'est-ce que c'est ? ». </p><div class="screenshot"><div xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="mediaobject"><img src="scriptbuilder.png" alt="Outil de construction de scripts"></div></div><p>Le constructeur de scripts est visible dans la capture d'écran ci-dessus. La zone à gauche est la <em class="firstterm">zone de script actuel</em> ; elle affiche la liste des commandes que comprend le script actuellement en fonctionnement. La zone à droite est le <em class="firstterm">navigateur de fonctions</em> ; il affiche la liste de toutes les fonctions de script disponibles. Sous le navigateur de fonctions, se trouve un petit panneau qui affiche une courte documentation sur la fonction de script surlignée dans le navigateur de fonction. Le panneau sous la zone de script courante est le <em class="firstterm">panneau des arguments de fonctions</em> ; quand une fonction est surlignée dans la zone de script courant, ce panneau contient des éléments pour spécifier les valeurs pour n'importe quel argument que la fonction surlignée nécessite. </p><p>Le long du haut de la fenêtre, il y a une rangée de boutons qui opèrent sur le script comme un tout. De la gauche vers la droite, il y a : <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Nouveau script</span></span>, <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Ouvrir un script…</span></span>, <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Enregistrer le script</span></span>, <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Enregistrer le script sous…</span></span> et <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Tester le script</span></span>. La fonction de ces boutons devrait être évidente, sauf peut-être le dernier bouton. En actionnant <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Tester le script</span></span>, vous tenterez de lancer le script courant dans la fenêtre principale de <span class="application">KStars</span>. Vous devrez déplacer la fenêtre de générateur de script hors de l'emplacement avant d'actionner cela, et ainsi, vous pourrez voir le résultat. </p><p>Au centre de la fenêtre se trouve une colonne de boutons qui opèrent sur une fonction individuelle du script. De haut en bas, ce sont : <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Ajouter la fonction</span></span>, <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Supprimer la fonction</span></span>, <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Copier la fonction</span></span>, <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Monter</span></span> et <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Descendre</span></span>. <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Ajouter la fonction</span></span> ajoute la fonction actuellement sélectionnée dans le navigateur de fonctions à la zone de script courant (vous pouvez aussi ajouter une fonction en double-cliquant dessus). Le reste des boutons opère sur la fonction surlignée dans la zone de script courant, soit en l'enlevant, soit en la dupliquant, soit en changeant sa position dans le script courant. </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="sb-using"></a>Utilisation du constructeur de scripts</h3></div></div></div><p>Pour illustrer l'utilisation du constructeur de scripts, nous présentons un petit tutoriel où nous faisons un script qui suit la Lune, alors que l'horloge fonctionne à une vitesse accélérée. </p><p>Si nous voulons suivre la Lune, nous aurons besoin de pointer l'affichage dessus d'abord. La fonction <em class="firstterm">lookTowards</em> est utilisée pour faire cela. Surlignez cette fonction dans le navigateur de fonctions et notez la documentation affichée dans le panneau au-dessous. Actionnez le bouton <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Ajouter une fonction</span></span> pour ajouter cette fonction à la zone de script courante. Le panneau des arguments de fonction comportera maintenant une liste combinée libellée <span class="quote">“<span class="quote">Dir</span>”</span>, abréviation de direction. C'est la direction dans laquelle l'affichage doit être pointé. La liste combinée ne contient que les points cardinaux, pas la Lune ni d'autres objets. Vous pouvez soit écrire <span class="quote">“<span class="quote">Lune</span>”</span> dans la zone à la main, soit actionner le bouton <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Objet…</span></span> pour utiliser la fenêtre de <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guilabel">recherche d'objet</span></span> pour sélectionner la Lune dans la liste des objets nommés. Notez que, comme d'habitude, un centrage sur un objet engage automatiquement le mode de suivi, de telle manière qu'il n'y a pas besoin d'ajouter la fonction <em class="firstterm">setTracking</em> après lookTowards. </p><p>Maintenant que nous avons pris soin de pointer la Lune, nous voulons ensuite faire passer le temps en accéléré. Utilisez la fonction <em class="firstterm">setClockScale</em> pour cela. Ajoutez-la au script en double-cliquant dessus dans le navigateur de fonctions. Le panneau des arguments de fonctions contient un compteur de pas du temps pour régler le pas désiré pour l'horloge de simulation. Changez le pas sur 3 heures. </p><p>Bien. Nous avons pointé la Lune et accéléré l'horloge. Maintenant, nous voulons simplement que le script attende plusieurs secondes pendant que l'affichage suit la Lune. Ajoutez la fonction <em class="firstterm">waitFor</em> au script, et utilisez le panneau des arguments de fonction pour spécifier qu'il devrait attendre 20 secondes avant de continuer. </p><p>Pour finir, réinitialisons le pas d'horloge à la valeur normale d'une seconde. Ajoutez une autre instance de setClockScale, et positionnez sa valeur sur 1 sec. </p><p>En fait, tout n'est pas fini. Nous devons probablement nous assurer que l'affichage utilise les coordonnées équatoriales avant que le script ne suive la Lune avec le pas accéléré. Sinon, si l'affichage utilise les coordonnées horizontales, il tournera très vite sur de grands angles au lever et au coucher de la Lune. Ceci peut être troublant, et on l'évite en réglant l'option d'affichage <em class="firstterm">UseAltAz</em> sur <span class="quote">“<span class="quote">false</span>”</span>. Pour changer une option d'affichage, utilisez la fonction <em class="firstterm">changeViewOption</em>. Ajoutez cette fonction au script, et examinez le panneau des arguments de fonction. Il y a une liste combinée qui contient la liste de toutes les options d'affichage qui peuvent être ajustées par changeViewOption. Comme nous savons que nous voulons l'option UseAltAz, nous pouvons simplement la sélectionner dans la liste combinée. Cependant, la liste est assez longue, et il n'y a pas d'explication sur l'utilisation de chaque élément. Pour cela, il peut être plus facile d'actionner le bouton <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Parcourir l'arborescence…</span></span>, qui ouvrira une fenêtre contenant une vue arborescente des options disponibles, organisées par sujet. De plus, chaque élément dispose d'une courte explication sur ce que fait l'option, et le type de donnée de valeur de l'option. Nous trouvons UseAltAz sous la catégorie <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guilabel">Options de carte du ciel</span></span>. Surlignez simplement cet élément et actionnez <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Ok</span></span>, et elle sera sélectionnée dans la liste combinée du panneau des arguments de fonctions. Enfin, rendez sa valeur <span class="quote">“<span class="quote">false</span>”</span> ou <span class="quote">“<span class="quote">0</span>”</span>. </p><p>Une dernière étape : le changement d'UseALtAz à la fin du script n'est pas bon ; nous avons besoin de le changer avant que quelque chose d'autre n'arrive. Ainsi, assurez-vous que cette fonction est surlignée dans la zone de script courant, et actionnez le bouton <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Monter</span></span> jusqu'à ce que ce soit la première fonction. </p><p>Maintenant que nous avons fini le script, nous devrions l'enregistrer sur le disque. Actionnez le bouton <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Enregistrer le script</span></span>. Cela ouvrira d'abord une fenêtre dans laquelle vous pouvez fournir un nom pour le script, et remplir votre nom en comme auteur. Écrivez <span class="quote">“<span class="quote">Suivi de la Lune</span>”</span> comme nom, et votre nom comme auteur, et actionnez le bouton <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Ok</span></span>. Ensuite, vous verrez la boîte de dialogue standard de <span class="orgname">KDE</span> d'enregistrement des fichiers. Donnez un nom de fichier pour le script et actionnez <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guibutton">Ok</span></span> pour enregistrer le script. Notez que si votre nom de fichier ne se termine pas par <span class="quote">“<span class="quote">.kstars</span>”</span>, ce suffixe sera automatiquement ajouté. Si vous êtes curieux, vous pouvez examiner le fichier de script avec un éditeur de texte. </p><p>Maintenant que nous avons un script terminé, nous pouvons le lancer de plusieurs manières. De l'invite d'une console, vous pouvez simplement exécuter le script tant qu'une instance de <span class="application">KStars</span> est en fonctionnement. Vous pouvez également exécuter le script depuis <span class="application">KStars</span> en utilisant l'élément <span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guimenuitem">Exécuter un script…</span></span>+<span xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" class="guiitem"><span class="guimenu">Fichier</span></span>. </p></div></div></div><div id="footer"><div class="navCenter"><table class="navigation"><tr><td class="prevCell"><a accesskey="p" href="tool-whatsup.html">Prev</a></td><td class="upCell"><a accesskey="h" href="index.html">Contents</a></td><td class="nextCell"><a accesskey="n" href="tool-solarsys.html">Next</a></td></tr><tr><td class="prevCell">Dans le ciel cette nuit </td><td class="upCell">Outils de <span class="application">KStars</span></td><td class="nextCell"> Afficheur du système solaire</td></tr></table></div><div id="footer_text">Would you like to make a comment or contribute an update to this page?<br>Send feedback to the <a href="mailto:kde-doc-english@kde.org" class="footer_email">KDE Docs Team</a></div></div></div></body></html>